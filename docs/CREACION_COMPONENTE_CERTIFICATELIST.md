# üìù Creaci√≥n del Componente CertificateList

## üéØ Objetivo

Crear un componente React/TypeScript que gestione la visualizaci√≥n de una lista paginada y filtrada de certificados NFT de carbono, utilizando el hook `useCertificates` y componentes del Stellar Design System.

---

## ‚úÖ Tareas Completadas

### Archivos Creados/Modificados

1. **`src/components/CertificateList.tsx`** (Nuevo - 325 l√≠neas)
   - Componente completo de lista con filtros, ordenamiento y paginaci√≥n

2. **`src/pages/Home.tsx`** (Modificado)
   - Integraci√≥n del componente CertificateList
   - Reemplazo del demo simple por la lista completa

---

## üìä Caracter√≠sticas del Componente

### 1. **Estados Locales de UI**

```typescript
const [offset, setOffset] = useState(0);
const [limit] = useState(10); // Certificados por p√°gina
const [minCo2e, setMinCo2e] = useState<string>("");
const [maxCo2e, setMaxCo2e] = useState<string>("");
const [sortByTag, setSortByTag] = useState<"Co2eTons" | "Hectares" | "CertificateId">("CertificateId");
const [isDescending, setIsDescending] = useState(false);
```

**Caracter√≠sticas:**
- ‚úÖ Paginaci√≥n con `offset` y `limit`
- ‚úÖ Filtros de CO2e (min/max)
- ‚úÖ Ordenamiento configurable
- ‚úÖ Direcci√≥n de orden (asc/desc)

---

### 2. **Integraci√≥n con useCertificates**

```typescript
const { data, isLoading, error } = useCertificates({
  offset,
  limit,
  minCo2e: minCo2eNum,
  maxCo2e: maxCo2eNum,
  sortBy,
  isDescending,
});
```

**Flujo de datos:**
- Hook maneja toda la l√≥gica de consulta
- Componente solo gestiona estado de UI
- Separaci√≥n clara de responsabilidades

---

### 3. **Filtros y Controles**

#### Inputs de CO2e

```tsx
<Input
  label="CO‚ÇÇe M√≠nimo (toneladas)"
  id="minCo2e"
  fieldSize="md"
  type="number"
  value={minCo2e}
  onChange={(e) => setMinCo2e(e.target.value)}
  placeholder="Ej: 100"
/>
```

#### Selector de Ordenamiento

```tsx
<Select
  id="sortBy"
  fieldSize="md"
  value={sortByTag}
  onChange={(e) => {
    const value = e.target.value as "Co2eTons" | "Hectares" | "CertificateId";
    setSortByTag(value);
  }}
>
  <option value="CertificateId">ID del Certificado</option>
  <option value="Co2eTons">CO‚ÇÇe Reducido</option>
  <option value="Hectares">Hect√°reas No Quemadas</option>
</Select>
```

#### Botones de Acci√≥n

```tsx
<Button variant="primary" onClick={handleApplyFilters}>
  Aplicar Filtros
</Button>
<Button variant="secondary" onClick={handleClearFilters}>
  Limpiar Filtros
</Button>
```

---

### 4. **Paginaci√≥n Navegable**

#### Controles de Paginaci√≥n

```tsx
<Box gap="md" direction="row" align="center" justify="space-between">
  <Text as="p" size="md">
    P√°gina {currentPage} de {totalPages}
  </Text>
  
  <Button onClick={handlePreviousPage} disabled={offset === 0}>
    Anterior
  </Button>
  <Button onClick={handleNextPage} disabled={offset + limit >= data.total}>
    Siguiente
  </Button>
</Box>
```

#### Navegaci√≥n Inteligente

```typescript
const handlePageChange = (newOffset: number) => {
  setOffset(newOffset);
  // Scroll al inicio de la lista
  window.scrollTo({ top: 0, behavior: "smooth" });
};
```

---

### 5. **Renderizado de Certificados**

#### Iteraci√≥n sobre IDs

```tsx
{data.certificateIds.map((certificateId) => (
  <CertificateCard
    key={typeof certificateId === 'number' ? certificateId : certificateId.toString()}
    certificateId={certificateId}
  />
))}
```

#### Estado Vac√≠o

```tsx
{data.certificateIds.length === 0 ? (
  <Alert variant="warning" title="Sin resultados">
    {hasFilters 
      ? "No se encontraron certificados que coincidan con los filtros."
      : "No tienes certificados de carbono a√∫n."}
  </Alert>
) : (
  // Lista de certificados
)}
```

---

## üé® Estructura Visual

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Mis Certificados de Carbono                           ‚îÇ
‚îÇ  Mostrando 10 de 45 certificados                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ Filtros y Ordenamiento                           ‚îÇ ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ
‚îÇ  ‚îÇ CO‚ÇÇe M√≠n | CO‚ÇÇe M√°x | Ordenar por | Orden        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ [  100  ] [ 1000  ] [ ID ‚úì     ] [Ascendente]   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ [Aplicar Filtros] [Limpiar Filtros]              ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ Certificado NFT #1                                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ [Datos del certificado]                           ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ Certificado NFT #2                                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ [Datos del certificado]                           ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ...                                                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  P√°gina 1 de 5    [Anterior] [Siguiente]              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîÑ Flujo de Interacci√≥n

### 1. Carga Inicial

```
Usuario abre p√°gina
  ‚Üì
Componente renderiza
  ‚Üì
useCertificates consulta con offset=0, limit=10
  ‚Üì
Hook retorna { data, isLoading, error }
  ‚Üì
UI muestra loader ‚Üí Lista de certificados
```

### 2. Aplicar Filtros

```
Usuario ingresa minCo2e=100, maxCo2e=1000
  ‚Üì
Click "Aplicar Filtros"
  ‚Üì
handleApplyFilters resetea offset a 0
  ‚Üì
Hook consulta con nuevos filtros
  ‚Üì
UI muestra resultados filtrados
```

### 3. Cambiar de P√°gina

```
Usuario click "Siguiente"
  ‚Üì
handleNextPage calcula nuevo offset
  ‚Üì
Scroll suave al inicio
  ‚Üì
Hook consulta con nuevo offset
  ‚Üì
UI muestra siguiente p√°gina
```

---

## üìù Handlers Implementados

### handlePageChange

```typescript
const handlePageChange = (newOffset: number) => {
  setOffset(newOffset);
  window.scrollTo({ top: 0, behavior: "smooth" });
};
```

**Caracter√≠sticas:**
- Actualiza offset
- Scroll suave al inicio
- Evita re-renders innecesarios

### handleApplyFilters

```typescript
const handleApplyFilters = () => {
  setOffset(0); // Volver a primera p√°gina
};
```

**Raz√≥n:** Al cambiar filtros, mostrar desde el inicio

### handleClearFilters

```typescript
const handleClearFilters = () => {
  setMinCo2e("");
  setMaxCo2e("");
  setOffset(0);
};
```

**Caracter√≠sticas:**
- Limpia todos los filtros
- Resetea paginaci√≥n
- Activa bot√≥n solo si hay filtros

---

## üé® Componentes Stellar Design System Utilizados

| Componente | Uso |
|------------|-----|
| `Card` | Contenedores de filtros y paginaci√≥n |
| `Box` | Layout flexible y espaciado |
| `Text` | T√≠tulos, subt√≠tulos, etiquetas |
| `Input` | Campos de filtro CO2e |
| `Select` | Ordenamiento y direcci√≥n |
| `Button` | Acciones y navegaci√≥n |
| `Alert` | Errores y advertencias |
| `Loader` | Estado de carga |

---

## üîç Validaciones y Manejo de Errores

### Validaci√≥n de Filtros

```typescript
const minCo2eNum = minCo2e ? Number(minCo2e) : undefined;
const maxCo2eNum = maxCo2e ? Number(maxCo2e) : undefined;

// Pasados al hook solo si ambos est√°n definidos
```

### Estados Deshabilitados

```tsx
<Button 
  onClick={handleApplyFilters}
  disabled={!hasFilters}  // Solo habilitar si hay filtros
>
  Aplicar Filtros
</Button>
```

### Paginaci√≥n Protegida

```tsx
<Button 
  onClick={handlePreviousPage}
  disabled={offset === 0}  // Deshabilitar en primera p√°gina
>
  Anterior
</Button>
```

---

## üìä C√°lculos de Paginaci√≥n

### Informaci√≥n de P√°gina

```typescript
const currentPage = Math.floor(offset / limit) + 1;
const totalPages = data ? Math.ceil(Number(data.total) / limit) : 0;
```

**Ejemplo:**
- `offset = 20`, `limit = 10` ‚Üí `currentPage = 3`
- `total = 45`, `limit = 10` ‚Üí `totalPages = 5`

### Navegaci√≥n Segura

```typescript
const handleNextPage = () => {
  if (data && offset + limit < data.total) {
    handlePageChange(offset + limit);
  }
};
```

**Previene:** Navegar m√°s all√° del total disponible

---

## üöÄ Uso del Componente

### Integraci√≥n Simple

```tsx
import { CertificateList } from "../components/CertificateList";

const MyPage = () => (
  <div>
    <h1>Mis Certificados</h1>
    <CertificateList />
  </div>
);
```

### Con Layout Personalizado

```tsx
<Layout.Content>
  <Layout.Inset>
    <CertificateList />
  </Layout.Inset>
</Layout.Content>
```

---

## üéØ Separaci√≥n de Responsabilidades

### useCertificates (Hook)

‚úÖ L√≥gica de consulta blockchain  
‚úÖ Cache y auto-refetch  
‚úÖ Manejo de errores de red  
‚úÖ Transformaci√≥n de datos  

### CertificateList (Componente)

‚úÖ Estado local de UI  
‚úÖ Interacci√≥n del usuario  
‚úÖ Handlers y callbacks  
‚úÖ Renderizado y presentaci√≥n  

**Separaci√≥n clara:** El componente solo gestiona UI, el hook maneja datos

---

## üí° Optimizaciones Implementadas

### 1. Scroll Autom√°tico

```typescript
window.scrollTo({ top: 0, behavior: "smooth" });
```

**Beneficio:** UX mejorada al cambiar de p√°gina

### 2. Botones Condicionales

```typescript
disabled={!hasFilters}
disabled={offset === 0}
```

**Beneficio:** Previene acciones inv√°lidas

### 3. Mensajes Contextuales

```typescript
{hasFilters 
  ? "No se encontraron certificados que coincidan con los filtros."
  : "No tienes certificados de carbono a√∫n."}
```

**Beneficio:** Feedback claro al usuario

---

## üß™ Casos de Uso Cubiertos

### 1. Usuario sin certificados

```
Estado: data.certificateIds.length === 0
UI: Alert "No tienes certificados"
```

### 2. Filtros sin resultados

```
Estado: hasFilters && data.certificateIds.length === 0
UI: Alert "No coinciden con filtros"
```

### 3. Primera/√öltima p√°gina

```
Botones: disabled apropiadamente
Navegaci√≥n: Prevenida si no aplica
```

### 4. Red no disponible

```
Error: Mostrado en Alert
Recuperaci√≥n: Auto-retry por hook
```

---

## üìà Mejoras Futuras Sugeridas

### 1. Debounce en Filtros

```typescript
const debouncedMinCo2e = useDebounce(minCo2e, 500);
// Solo aplicar filtro tras 500ms de inactividad
```

### 2. B√∫squeda por Texto

```tsx
<Input
  label="Buscar certificado"
  value={searchQuery}
  onChange={(e) => setSearchQuery(e.target.value)}
/>
```

### 3. Vista de Grid

```tsx
<Box gap="md" direction="row" wrap="wrap">
  {/* Certificados en grid de 3 columnas */}
</Box>
```

### 4. Exportar Resultados

```tsx
<Button onClick={() => exportToCSV(data)}>
  Exportar a CSV
</Button>
```

---

## üìä Resumen T√©cnico

| Aspecto | Detalles |
|---------|----------|
| **L√≠neas de c√≥digo** | 325 |
| **Estados locales** | 6 |
| **Handlers** | 5 |
| **Componentes SDS** | 8 tipos |
| **Casos de estado** | 4 (loading, error, empty, success) |
| **Tipificaci√≥n** | 100% estricta |
| **Tests** | Pendientes |
| **Estado** | ‚úÖ Completo |

---

## ‚úÖ Checklist de Implementaci√≥n

- [x] Integraci√≥n con useCertificates
- [x] Estados locales para filtros
- [x] Inputs de CO2e
- [x] Selector de ordenamiento
- [x] Controles de paginaci√≥n
- [x] Renderizado de CertificateCard
- [x] Manejo de estados (loading/error)
- [x] Handlers de navegaci√≥n
- [x] Scroll autom√°tico
- [x] Validaciones de UI
- [x] Mensajes contextuales
- [x] Dise√±o responsive (wrap)
- [x] Sin errores de linter
- [ ] Tests unitarios
- [ ] Tests de integraci√≥n
- [ ] Accesibilidad (ARIA labels)

---

## üéâ Resultado Final

Componente `CertificateList` completamente funcional que:

- ‚úÖ Lista certificados con paginaci√≥n
- ‚úÖ Filtra por rango de CO2e
- ‚úÖ Ordena por m√∫ltiples criterios
- ‚úÖ Navega entre p√°ginas
- ‚úÖ Maneja todos los estados
- ‚úÖ Usa Stellar Design System
- ‚úÖ Separaci√≥n de responsabilidades clara
- ‚úÖ UX pulida y profesional

---

## üöÄ Pr√≥ximos Pasos

### Sugerencias de Mejora

1. **Testing:** Agregar tests unitarios y de integraci√≥n
2. **Accesibilidad:** Labels ARIA, navegaci√≥n por teclado
3. **Performance:** Virtualizaci√≥n para listas muy grandes
4. **Features:** Export, b√∫squeda, favoritos
5. **Responsive:** Mejor adaptaci√≥n a m√≥viles

### Componentes Relacionados

- ‚úÖ `CertificateCard` - Ya creado
- ‚úÖ `useCertificates` - Ya creado
- ‚úÖ `CertificateList` - Reci√©n creado
- üìù `CertificateForm` - Para crear certificados (pr√≥ximo)
- üìù `CertificateDetail` - Vista individual (pr√≥ximo)

---

**Autor:** AI Assistant  
**Fecha:** 2025-01-28  
**Versi√≥n:** 1.0.0  
**Estado:** ‚úÖ Completado

